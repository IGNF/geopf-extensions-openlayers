<!DOCTYPE html>
<html lang="fr" data-fr-theme="light">
    <head>
        <meta charset="UTF-8"> 
        <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Library OpenLayers -->
        <link rel="stylesheet" href="../../resources/vendor/ol/v8.2.0/ol.css" />
        <script src="../../resources/vendor/ol/v8.2.0/ol.js"></script>
        <!-- OL-context-menu -->
        <link rel="stylesheet" href="../../../node_modules/ol-contextmenu/dist/ol-contextmenu.css" />
        <!-- Library Access Geoportal Service -->
        <script src="../../../node_modules/geoportal-access-lib/dist/GpServices.js"></script>
        <!-- DSFR theme -->
        <link rel="stylesheet" href="../../../node_modules/@gouvfr/dsfr/dist/dsfr.css" />
        <link rel="stylesheet" href="../../../node_modules/@gouvfr/dsfr/dist/utility/icons/icons.css" />
        <link rel="stylesheet" href="../../../dist/modules/Dsfr.css" />
        <!-- CSS & Modules IGN -->
                 
        <link rel="stylesheet" href="../../../dist/modules/GpfExtOlLayerSwitcher.css" />
        <script src="../../../dist/modules/GpfExtOlLayerSwitcher.js"></script>
        <link rel="stylesheet" href="../../../dist/modules/GpfExtOlContextMenu.css" />
        <script src="../../../dist/modules/GpfExtOlContextMenu.js"></script>
        <script src="../../../dist/modules/GpfExtOlLayers.js"></script>
        <link rel="stylesheet" href="../../../dist/modules/GpfExtOlIsocurve.css" />
        <script src="../../../dist/modules/GpfExtOlIsocurve.js"></script>
        <link rel="stylesheet" href="../../../dist/modules/GpfExtOlLayerImport.css" />
        <script src="../../../dist/modules/GpfExtOlLayerImport.js"></script>
        <link rel="stylesheet" href="../../../dist/modules/GpfExtOlLegends.css" />
        <script src="../../../dist/modules/GpfExtOlLegends.js"></script>
        <link rel="stylesheet" href="../../../dist/modules/GpfExtOlRoute.css" />
        <script src="../../../dist/modules/GpfExtOlRoute.js"></script>
        <link rel="stylesheet" href="../../../dist/modules/GpfExtOlCatalog.css" />
        <script src="../../../dist/modules/GpfExtOlCatalog.js"></script>

        <title>Sample openlayers ContextMenu</title>
        <style>
            div#map {
                width: 100%;
                height: 500px;
                background-image:url("../../resources/geoportail-waiting.gif");
                background-position:center center;
                background-repeat:no-repeat;
            }
        </style>

    </head>
    <body>
        <h1>Extension Géoportail pour OpenLayers</h1>

        <button id="sampleLightDark" onclick="document.documentElement.dataset.frTheme = document.documentElement.dataset.frTheme == 'dark' ? 'light' : 'dark'">Toggle Darkmode / Lightmode</button>

            <h2>Ajout du widget du GetFeatureInfo, avec les options par défaut</h2>
            <!-- map -->
            <div id="map">
            </div>
            <button type="button" id="addVectorKml">Ajouter une couche vecteur kml</button>
            <button type="button" id="addVectorGpx">Ajouter une couche vecteur gpx</button>
            <button type="button" id="addWms">Ajouter une couche WMS</button>
            <button type="button" id="addWtms">Ajouter une couche WTMS</button>

    <script>
        var map;
        var createMap = function () {
            document.getElementById('map').style.backgroundImage = 'none';

            // 1. Création de la map
            map = new ol.Map({
                target : "map",
                view : new ol.View({
                    center : [288074.8449901076, 6247982.515792289],
                    zoom : 6
                })
            });

            // 2. Ajout de plusieurs couches différentes.
            var gpMaps = new ol.layer.Tile({
                source : new ol.source.GeoportalWMTS({
                    layer: "GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2"
                })
            });
            map.addLayer(gpMaps);

            // 3. Ajout du context menu
            var itemsOpt = [            {
                text : "Imprimer la carte",
                classname : "ol-context-menu-custom fr-text--md",
                callback : function() {alert("fonction à ajouter IMPRESSION!!")},
            }]
            
            var contextMenu = new ol.control.ContextMenu({
                contextMenuItemsOptions : itemsOpt
            });
            map.addControl(contextMenu);


            // 5. Ajout du contrôle de gestion de l'empilement des couches (layerSwitcher)
            var layerSwitcher = new ol.control.LayerSwitcher({
                options : {
                    collapsed: false
                }
            });
            map.addControl(layerSwitcher);

            var iso = new ol.control.Isocurve({
                  draggable: true,
                  position : "bottom-left"
                });
                map.addControl(iso);

                var layerImport = new ol.control.LayerImport({
                  draggable: true,
                  position : "bottom-left"
                });
                map.addControl(layerImport);

                var route = new ol.control.Route({
                  draggable: true,
                  position : "bottom-right",
                  listable: true,
                  description: "Calculez un itinéraire véhicule ou piéton entre deux ou plusieurs points",
                });
                map.addControl(route);
                
                var legends = new ol.control.Legends({
                    draggable: true,
                    position: "bottom-left",
                    panel: true,
                    auto: true
                });
                map.addControl(legends);
                var catalog = new ol.control.Catalog({
                    draggable: true,
                    position: "top-left",
                    panel: true,
                    auto: true
                });
                map.addControl(catalog);
        };
        Gp.Services.getConfig({
            customConfigFile : "https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/layers.json",
            callbackSuffix : "",
            // apiKey: "essentiels,cartes,adresse,lambert93",
            timeOut : 20000,
            onSuccess : createMap,
            onFailure : (e) => {
                console.error(e);
            }
        });
    </script>
    </body>
</html>
